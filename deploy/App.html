<!DOCTYPE html>
<html>
<head>
    <title>dynamic-prd-generation-app</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){this._createMilestoneWaspiDataStore()},_createMilestoneWaspiDataStore:function(){Ext.getBody().mask("Loading..."),console.log("Rally.environment.getContext().getProject()._ref : ",Rally.environment.getContext().getProject()._ref);var filter;filter=Ext.create("Rally.data.wsapi.Filter",{property:"TargetProject",operator:"=",value:Rally.environment.getContext().getProject()._ref}),milestoneWaspiDataStore=Ext.create("Rally.data.wsapi.Store",{model:"Milestone",autoLoad:!0,compact:!1,context:{workspace:Rally.environment.getContext().getWorkspace()._ref,project:Rally.environment.getContext().getProject()._ref,projectScopeUp:!1,projectScopeDown:!0},filters:filter,fetch:["ObjectID","FormattedID","Name","TargetDate","TargetProject","c_ActiveStartDate"],limit:1/0,listeners:{load:function(store,data,success){data.length>0?this._createMilestoneDataStore(data):Rally.ui.notify.Notifier.showError({message:"No Milestone is associated with the selected Project."}),Ext.getBody().unmask()},scope:this},sorters:[{property:"Name",direction:"ASC"}]})},_createMilestoneDataStore:function(myData){var milestoneArr=[];Ext.each(myData,function(data,index){var milestone={};milestone.ObjectID=data.data.ObjectID,milestone.FormattedID=data.data.FormattedID,milestone.Name=data.data.Name,milestone.TargetDate=data.data.TargetDate,milestone.TargetProject=data.data.TargetProject,milestone.ActiveStartDate=data.data.c_ActiveStartDate,milestoneArr.push(milestone)}),this.milestoneDataStore=Ext.create("Ext.data.Store",{fields:["ObjectID","FormattedID","Name","TargetDate","TargetProject","ActiveStartDate"],data:milestoneArr}),this._createMilestonePicker()},_createMilestonePicker:function(){this.milestonePicker=Ext.create("Ext.form.ComboBox",{fieldLabel:"Milestone ",store:this.milestoneDataStore,renderTo:Ext.getBody(),displayField:"Name",queryMode:"local",valueField:"ObjectID",border:1,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px",height:"40px"},width:400,padding:"10 5 5 10",margin:"10 5 5 10",shadow:"frame",labelAlign:"right",labelStyle:{margin:"10 5 5 10"},listeners:{select:function(combo,records,eOpts){this.selectedMilestone=combo.getValue(),this.selectedMilestoneObj=records,this._getMileStoneData()},scope:this}}),this.add(this.milestonePicker)},_getMileStoneData:function(){filter=Ext.create("Rally.data.wsapi.Filter",{property:"ObjectID",operator:"=",value:this.selectedMilestone}),milestoneWaspiDataStore=Ext.create("Rally.data.wsapi.Store",{model:"Milestone",autoLoad:!0,compact:!1,context:{workspace:Rally.environment.getContext().getWorkspace()._ref,project:Rally.environment.getContext().getProject()._ref,projectScopeUp:!1,projectScopeDown:!0},filters:filter,fetch:["ObjectID","FormattedID","Name","TargetDate","TargetProject","c_ActiveStartDate","Notes"],limit:1/0,listeners:{load:function(store,data,success){data.length>0?this._generateDoc(data):Rally.ui.notify.Notifier.showError({message:"No Milestone is associated with the selected Project."}),Ext.getBody().unmask()},scope:this},sorters:[{property:"Name",direction:"ASC"}]})},_generateDoc:function(milestoneData){var data=this._generateData(milestoneData[0].data),tpl=new Ext.XTemplate('<div style="font-size: medium;font-family: arial, Verdana, sans-serif"><h1 style="text-align : center;">Product Requirements Document (PRD)</h1>',"<br/><br/><br/>",'<table><tr><td><span style="text-decoration: underline; font-weight: bold; padding-right: 10px;">Product Name:</span><td> <td>{FormattedID} - {Name}</td></tr>',"<tr><td colspan=2>&nbsp;</td></tr>",'<tr><td><span style="text-decoration: underline; font-weight: bold; padding-right: 10px;">Date:</span><td> <td>{CurrentDate}</td></tr>','<tr><td><span style="text-decoration: underline; font-weight: bold; padding-right: 10px;">Contact:</span><td> <td>{userName}</td></tr>',"</table>",'<div style="font-size: small; font-family: arial, Verdana, sans-serif"" <p style="page-break-before: always;">&nbsp;</p>','<p style="text-decoration: underline; font-weight: bold; padding-right: 10px;">Document Revision History:</p>','<table style="border-collapse: collapse; border: 1px solid black; width: 590px;"><tr><th style="border: 1px solid black;">&nbsp;Date&nbsp;</th><th style="border: 1px solid black;">&nbsp;Revision&nbsp;</th><th style="border: 1px solid black;">&nbsp;Description&nbsp;</th><th style="border: 1px solid black;">&nbsp;Author&nbsp;</th></tr>','<tr><td style="border: 1px solid black;">&nbsp;{CurrentDate}&nbsp;</td><td style="border: 1px solid black;">&nbsp;0.1&nbsp;</td><td style="border: 1px solid black;">&nbsp;Initial PRD&nbsp;</td><td style="border: 1px solid black;">&nbsp;{userName}&nbsp;</td></tr>','<tr><td style="border: 1px solid black;">&nbsp;&lt;Enter date&gt;&nbsp;</td><td style="border: 1px solid black;">&nbsp;&lt;#.&gt;&nbsp;</td><td style="border: 1px solid black;">&nbsp;&lt;Descibe Changes.&gt;&nbsp;</td><td style="border: 1px solid black;">&nbsp;&lt;Enter Name.&gt;&nbsp;</td></tr>','<tr><td style="border: 1px solid black;">&nbsp;</td><td style="border: 1px solid black;">&nbsp;</td><td style="border: 1px solid black;">&nbsp;</td><td style="border: 1px solid black;">&nbsp;</td></tr>','<tr><td style="border: 1px solid black;">&nbsp;</td><td style="border: 1px solid black;">&nbsp;</td><td style="border: 1px solid black;">&nbsp;</td><td style="border: 1px solid black;">&nbsp;</td></tr>',"</table>",'<p style="page-break-before: always;">&nbsp;</p>',"<ol>",'<li style="padding-bottom: 15px;"><h2 style="font-size: 18px; background-color: gray;color: white;border-top: 2px solid black;border-bottom: 2px solid black;"> Overview <br/> </h2>',"<ol>","<li>","<h3>Document Objective</h3>","<p>The Product Requirements Document (PRD) provides a complete requirements definition of a product, based on the market requirements.  The PRD describes the features of a product without regard to implementation. </p>","</li>","<li>","<h3>General description</h3>","<p>{Notes}</p>","</li>","</ol>","</li>",'<li style="padding-bottom: 15px;"><h2 style="font-size: 18px; background-color: gray;color: white;border-top: 2px solid black;border-bottom: 2px solid black;"> Product Features <br/> </h2>',"</li>","</ol>","</div> </div>");null!==this.down("#doc-container")&&this.down("#doc-container").destroy(),this.add({xtype:"container",id:"doc-container",html:tpl.apply(data)})},_generateData:function(milestoneData){var data={};return data.FormattedID=milestoneData.FormattedID,data.Name=milestoneData.Name,data.CurrentDate=Ext.Date.format(new Date,"d-M-Y"),data.userName=this.getContext().getUser().DisplayName,data.Notes=milestoneData.Notes.split("<li>").join("").split("</li>").join("<br>"),console.log(data),data}});

            Rally.launchApp('CustomApp', {
                name:"dynamic-prd-generation-app",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
